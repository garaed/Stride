<p align="center">
  <img height="100" height="auto" src="https://user-images.githubusercontent.com/50621007/183283696-d1c4192b-f594-45bb-b589-15a5e57a795c.png">
</p>

# Перенос валидатора на другой сервер

### 1. Запустите фуллноду на новом сервере
Для установки ноды воспользуйтесь моей инструкцией (https://github.com/garaed/Stride/blob/main/README.md)

### 2. Убедитесь, что у вас есть сид фраза восстановления для активного ключа, запущенного на прошлом сервере

#### Для сохранения ключа воспользуйтесь командой ниже
```
strided keys export mykey
```
> (Примечание) Эта комманда выведет закрытый ключ, который затем можно вставить в файл `mykey.backup`.
#### Получение списка ключей
```
strided keys list
```

### 3. Восстановите активный ключ на новом сервере

#### Комманда ниже восстановит активный ключ при помощи мнемоники
```
strided keys add mykey --recover
```

#### или воспользуйтесь этой коммандой для восстановления при помощи файла `mykey.backup` который был получен выше
```
strided keys import mykey mykey.backup
```

### 4. Дождитесь пока фуллнода на новом сервере закончит синхронизацию.

#### Для проверки синхронизации воспользуйтесь коммандой ниже
```
strided status 2>&1 | jq .SyncInfo
```
> _`catching_up` должен быть с результатом - `false`_
### 5. После того как новая нода завершила синхронизацию, остановите ноду валидатора.

> _Остановка необходима для избежания двойной подписи блоков. Но убедитесь что синхронизация новой ноды прошла и высота блока выше чем в ноде валидатора._
> _Если высота блока новой ноды ниже ноды валидатора, это может привести к двойному подписанию блоков и джейлу._
#### Остановите и отключите сервис на старом сервере
```
sudo systemctl stop strided
sudo systemctl disable strided
```
> _Валидатор должен начять пропускать блоки на этом моменте_
### 6. Остановите сервис на новом сервере
```
sudo systemctl stop strided
```

### 7. Перенесите приватный ключ валидатора со старого сервера на новый сервер
#### Приватный ключ расположен в: `~/.strided/config/priv_validator_key.json`

> _После переноса приватного ключа на новый сервер, удалите ключ со старого сервера во избежание двойной подписи блоков_
```
sudo mv ~/.strided/config/priv_validator_key.json ~/.strided/bak_priv_validator_key.json
```
### 8. Запуск сервиса на новом сервере
```
sudo systemctl start strided
```
> _Новая нода должна начать подписывать блоки, как только догонит актульную высоту блока_
### 9. Убедитесь что валидатор не попал в джейл
#### Для анджейла валидатора используйте команду ниже
```
strided tx slashing unjail --chain-id $STRIDE_CHAIN_ID --from mykey --gas=auto -y
```

### 10. Убедитесь что новый валидатор начал подписывать блоки и он работоспособен. После этого вы можете отключать старый сервер.
